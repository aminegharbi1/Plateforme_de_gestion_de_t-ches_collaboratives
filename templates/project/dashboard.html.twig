{% extends "base.html.twig" %}

{% block title %}Dashboard
{% endblock %}

{% block body %}
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
	<link rel="stylesheet" href="{{ asset('css/dashboard.css') }}">

	<style>
		.stat-card {
			border-radius: 1rem;
			min-height: 130px;
		}
		.stat-icon {
			background: #fff;
			border-radius: 50%;
			padding: 12px;
			font-size: 1.8rem;
		}
		.progress {
			height: 6px;
			border-radius: 10px;
		}
	</style>

	<div
		class="container-fluid d-flex align-items-center">

		<!-- RIGHT: ICONS + USER -->
		<div
			class="d-flex align-items-center gap-4 ms-auto">
			<!-- SHORTCUT -->
			<button class="btn btn-light rounded-circle">
				<i class="bi bi-grid"></i>
			</button>

			<!-- NOTIFICATIONS -->
			<div class="position-relative">
				<button class="btn btn-light rounded-circle">
					<i class="bi bi-bell"></i>
				</button>
				<span class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">
					2
				</span>
			</div>

			<!-- USER ICON (click opens modal directly) -->
			<a href="#" onclick="openProfileModal()" class="d-flex align-items-center text-decoration-none">
				<i class="bi bi-person-circle fs-3"></i>
			</a>

			<!-- PROFILE MODAL -->
			<div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
				<div class="modal-dialog modal-dialog-centered">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title" id="profileModalLabel">User Profile</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
						</div>
						<div class="modal-body text-center">
							<i class="bi bi-person-circle fs-1 mb-3"></i>
							<p class="text-muted">{{ app.user.email }}</p>
							<p>Additional info about the user can go here.</p>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
						</div>
					</div>
				</div>
			</div>

			<script>
				function openProfileModal() {
const modal = new bootstrap.Modal(document.getElementById('profileModal'));
modal.show();
}
			</script>
		</div>
	</div>

	<div
		class="container-fluid py-4">

		<!-- DASHBOARD HEADER -->
<!-- DASHBOARD HEADER -->
<div class="dashboard-header mb-5 p-4 rounded-4 shadow-lg position-relative overflow-hidden" style="background: linear-gradient(135deg, #4e54c8, #8f94fb); color: #fff;">
    <!-- Background decorative shapes -->
    <div class="position-absolute top-0 start-0 w-100 h-100" style="opacity: 0.1; pointer-events: none;">
        <svg width="100%" height="100%">
            <circle cx="20%" cy="30%" r="100" fill="white" />
            <circle cx="80%" cy="70%" r="150" fill="white" />
        </svg>
    </div>

    <div class="position-relative d-flex flex-column flex-md-row justify-content-between align-items-center">
        <!-- Welcome Text -->
        <div>
            <h1 class="fw-bold display-5 mb-2">Dashboard</h1>
            <p class="mb-0 fs-5" style="opacity: 0.85;">Welcome back ðŸ‘‹</p>
        </div>

        <!-- Quick Stats / Actions -->
        <div class="d-flex gap-4 mt-3 mt-md-0">
            <div class="text-center bg-white bg-opacity-10 rounded-3 px-3 py-2">
                <h5 class="mb-0 fw-bold">12</h5>
                <small>Projects</small>
            </div>
            <div class="text-center bg-white bg-opacity-10 rounded-3 px-3 py-2">
                <h5 class="mb-0 fw-bold">34</h5>
                <small>Tasks</small>
            </div>
            <div class="text-center bg-white bg-opacity-10 rounded-3 px-3 py-2">
                <h5 class="mb-0 fw-bold">7</h5>
                <small>Users</small>
            </div>
        </div>
    </div>
</div>



		<!-- STATS -->
		<div class="row g-4 mb-4">

			<div class="col-md-3">
				<div class="stat-card p-4 shadow-sm" style="background:#e8f8ee;">
					<div class="d-flex justify-content-between">
						<div>
							<p class="text-muted mb-1">Total Projects</p>
							<h2 class="fw-bold">{{ projects|length }}</h2>
						</div>
						<div class="stat-icon text-success">
							<i class="bi bi-briefcase"></i>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="stat-card p-4 shadow-sm" style="background:#e8f4ff;">
					<div class="d-flex justify-content-between">
						<div>
							<p class="text-muted mb-1">Tasks</p>
							<h2 class="fw-bold">{{ totalTasks }}</h2>

						</div>
						<div class="stat-icon text-primary">
							<i class="bi bi-list-check"></i>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="stat-card p-4 shadow-sm" style="background:#eafaf1;">
					<div class="d-flex justify-content-between">
						<div>
							<p class="text-muted mb-1">Users</p>
							<h2 class="fw-bold">{{ usersCount ?? 0 }}</h2>
						</div>
						<div class="stat-icon text-danger">
							<i class="bi bi-people"></i>
						</div>
					</div>
				</div>
			</div>

			<div class="col-md-3">
				<div class="stat-card p-4 shadow-sm" style="background:#fff6e5;">
					<div class="d-flex justify-content-between">
						<div>
							<p class="text-muted mb-1">Productivity</p>
							<h2 class="fw-bold">76%</h2>
						</div>
						<div class="stat-icon text-warning">
							<i class="bi bi-activity"></i>
						</div>
					</div>
				</div>
			</div>

		</div>

		<!-- CONTENT -->
		<div
			class="row g-4">

			<!-- PROJECTS -->
			<div class="col-lg-8">
				<div class="card shadow-sm border-0">
					<div class="card-body">
						<h5 class="fw-bold mb-4">Active Projects</h5>

						<div class="table-responsive">
							<table class="table align-middle">
								<thead class="text-muted">
									<tr>
										<th>Name</th>
										<th>Progress</th>
										<th>Status</th>
										<th>Assigned to</th>
									</tr>
								</thead>
								<tbody>

									{% for project in projects %}

										{% set progress = project.progress ?? 50 %}

										{% if project.endDate and project.endDate < 'now'|date %}
											{% set barColor = 'bg-danger' %}
											{% set badgeColor = 'bg-danger' %}
											{% set statusLabel = 'Completed' %}
										{% elseif progress < 40 %}
											{% set barColor = 'bg-warning' %}
											{% set badgeColor = 'bg-warning text-dark' %}
											{% set statusLabel = 'At Risk' %}
										{% elseif progress < 70 %}
											{% set barColor = 'bg-info' %}
											{% set badgeColor = 'bg-info' %}
											{% set statusLabel = 'On Track' %}
										{% else %}
											{% set barColor = 'bg-success' %}
											{% set badgeColor = 'bg-success' %}
											{% set statusLabel = 'Excellent' %}
										{% endif %}

										<tr>
											<td>
												<strong>{{ project.name }}</strong><br>
												<small class="text-muted">
													{{ project.startDate ? project.startDate|date('M d, Y') : '' }}
												</small>
											</td>

											<td style="width:180px">
												<small class="fw-bold">{{ progress }}%</small>
												<div class="progress">
													<div class="progress-bar {{ barColor }}" style="width: {{ progress }}%"></div>
												</div>
											</td>

											<td>
												<span class="badge {{ badgeColor }}">
													{{ statusLabel }}
												</span>
											</td>

											<td>
												<div class="d-flex align-items-center">
													<i class="bi bi-person-circle fs-4"></i>
													{# icon instead of avatar #}
												</div>
											</td>

											<td>
												<i class="bi bi-three-dots-vertical text-muted"></i>
											</td>
										</tr>

									{% endfor %}

								</tbody>
							</table>
						</div>

					</div>
				</div>
			</div>

			<!-- TASK PROGRESS -->
			<div class="col-lg-4">
				<div class="card shadow-sm border-0 h-100">
					<div class="card-body">
						<h5 class="fw-bold mb-3">Task Progress</h5>

						{% set progress = totalTasks > 0 ? (completedTasks / totalTasks * 100)|round : 0 %}

						<h1 class="fw-bold mb-3">{{ progress }}%</h1>

						<div class="progress mb-4">
							<div class="progress-bar bg-success" style="width:{{ progress }}%"></div>
						</div>

						<div class="row text-center">
							<div class="col">
								<h4 class="fw-bold">{{ completedTasks }}</h4>
								<small class="text-muted">Completed</small>
							</div>
							<div class="col">
								<h4 class="fw-bold">{{ totalTasks - completedTasks }}</h4>
								<small class="text-muted">Remaining</small>
							</div>
						</div>

					</div>
				</div>
			</div>

		</div>
	</div>
{% endblock %}
