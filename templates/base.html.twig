<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title>
			{% block title %}Task Manager
			{% endblock %}
		</title>
		<link href="https://cdn.jsdelivr.net/npm/bootswatch@5.3.2/dist/flatly/bootstrap.min.css" rel="stylesheet">
		<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
		<link rel="stylesheet" href="{{ asset('css/app.css') }}"> {% block styles %}{% endblock %}
		
		<style>
			/* ====== SIDEBAR ====== */
			.sidebar {
				background-color: #5c27fe;
				color: white;
				width: 250px;
				height: 100%;
				display: flex;
				flex-direction: column;
				transition: width 0.3s ease, left 0.3s ease;
				overflow: hidden;
				position: fixed;
				z-index: 1040;
			}

			body.sidebar-collapsed .sidebar {
				width: 70px;
			}
			.sidebar-header {
				display: flex;
				align-items: center;
				gap: 10px;
				padding: 20px;
				font-weight: bold;
			}
			.brand {
				white-space: nowrap;
			}
			.toggle-btn {
				cursor: pointer;
				color: #ffffffcc;
				font-size: 1.2rem;
				padding: 10px 20px;
			}
			.nav-menu {
				display: flex;
				flex-direction: column;
				gap: 5px;
				margin-top: 20px;
				list-style: none;
				padding-left: 0;
			}
			.nav-item {
				display: flex;
				align-items: center;
				gap: 16px;
				padding: 10px 20px;
				color: #ffffffcc;
				text-decoration: none;
				border-radius: 8px;
				transition: background 0.2s, color 0.2s;
			}
			.nav-item i {
				font-size: 0.9rem;
			}
			.nav-item span {
				transition: opacity 0.2s;
			}
			.nav-item:hover,
			.nav-item.active {
				background-color: rgba(255, 255, 255, 0.1);
				color: #fff;
			}
			body.sidebar-collapsed .nav-item span,
			body.sidebar-collapsed .brand {
				display: none;
			}

			/* overlay mobile */
			.sidebar-overlay {
				display: none;
				position: fixed;
				inset: 0;
				background: rgba(0, 0, 0, 0.5);
				z-index: 1035;
			}
			body.sidebar-open .sidebar-overlay {
				display: block;
			}

			/* Content */
			.flex-grow-1 {
				margin-left: 250px;
				transition: margin-left 0.3s;
			}
			body.sidebar-collapsed .flex-grow-1 {
				margin-left: 70px;
			}
			@media(max-width:768px) {
				.sidebar {
					left: -250px;
				}
				body.sidebar-open .sidebar {
					left: 0 !important;
				}
				.flex-grow-1 {
					margin-left: 0 !important;
				}
			}
		</style>
	</head>

	<body>
		<div
			class="d-flex">
			<!-- Sidebar -->
			<nav class="sidebar">
				<div class="sidebar-header">
					<i class="bi bi-layers-fill fs-4"></i>
					<span class="brand fs-5">Task Manager</span>
				</div>

				<div id="sidebarToggle" class="toggle-btn">
					<i class="bi bi-list fs-4"></i>
				</div>

				<div id="sidebarOverlay" class="sidebar-overlay"></div>

				<ul class="nav-menu">
					{% if app.user %}
						<li>
							<a href="{{ path('home') }}" class="nav-item {% if app.request.attributes.get('_route') == 'home' %}active{% endif %}">
								<i class="bi bi-house-fill"></i>
								<span>Home</span>
							</a>
						</li>

						<li>
							<a href="{{ path('dashboard') }}" class="nav-item {% if app.request.attributes.get('_route') == 'dashboard' %}active{% endif %}">
								<i class="bi bi-speedometer2"></i>
								<span>Dashboard</span>
							</a>
						</li>


						<li>
							<a href="{{ path('project_index') }}" class="nav-item {% if app.request.attributes.get('_route') == 'project_index' %}active{% endif %}">
								<i class="bi bi-folder2-open"></i>
								<span>Projects</span>
							</a>
						</li>

						<li>
							<a href="{{ path('app_task_index') }}" class="nav-item {% if app.request.attributes.get('_route') == 'app_task_index' %}active{% endif %}">
								<i class="bi bi-list-task"></i>
								<span>Tasks</span>
							</a>
						</li>

						<li>
							<a href="{{ path('app_logout') }}" class="nav-item">
								<i class="bi bi-box-arrow-in-right"></i>
								<span>Logout</span>
							</a>
						</li>
					{% else %}
						<li>
							<a href="{{ path('app_login') }}" class="nav-item">
								<i class="bi bi-person-circle"></i>
								<span>Login</span>
							</a>
						</li>
					{% endif %}
				</ul>
			</nav>

			<!-- Content -->
			<div class="flex-grow-1">
				<main class="p-4 page-fade"> {% block body %}{% endblock %}
					</main>
				</div>
			</div>

			<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

			<script>
				(function () {
const body = document.body;
const toggle = document.getElementById('sidebarToggle');
const overlay = document.getElementById('sidebarOverlay');

toggle && toggle.addEventListener('click', function () {
if (window.innerWidth <= 768) {
body.classList.toggle('sidebar-open');
} else {
body.classList.toggle('sidebar-collapsed');
try {
localStorage.setItem('sidebar-collapsed', body.classList.contains('sidebar-collapsed'));
} catch (e) {}
}
});

overlay && overlay.addEventListener('click', function () {
body.classList.remove('sidebar-open');
});

document.addEventListener('keydown', function (e) {
if (e.key === 'Escape') {
body.classList.remove('sidebar-open');
}
});

try {
if (localStorage.getItem('sidebar-collapsed') === 'true') {
body.classList.add('sidebar-collapsed');
}
} catch (e) {}
})();
			</script>

			{% block javascripts %}{% endblock %}
		</body>
	</html>
